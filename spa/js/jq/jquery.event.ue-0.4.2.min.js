!function(e){var t,n,o,a,_,u,i,d,r,m,l,s,p,c,h,v,x,b,g=e.event.special,f={},y=!1,w=-1,z="ue_bound",S=!1,E={bound_ns_map:{},wheel_ratio:15,px_radius:3,ignore_class:":input",tap_time:200,held_tap_time:300},k=[],X=1,Y=4;d=function(e){var t,n=0;for(t=this.length;t;0)this[--t]===e&&n++;return n},r=function(e){var t,n=0;for(t=this.length;t;0)this[--t]===e&&(this.splice(t,1),n++,t++);return n},m=function(e){return d.call(this,e)?!1:(this.push(e),!0)},l=function(t){if(t&&e.isArray(t)){if(t.remove_val)return console.warn("The array appears to already have listPlus capabilities"),t}else t=[];return t.remove_val=r,t.match_val=d,t.push_uniq=m,t},t=l(),n={setup:function(n,o){var a,_,u,i,d,r=this,m=e(r),s={};if(!e.data(this,z)){for(a={},e.extend(!0,a,E),e.data(r,z,a),d=l(o.slice(0)),d.length&&""!==d[0]||(d=["000"]),_=0;_<d.length;_++)u=d[_],u&&(s.hasOwnProperty(u)||(s[u]=!0,i=".__ue"+u,m.bind("mousedown"+i,v),m.bind("touchstart"+i,x),m.bind("mousewheel"+i,b)));t.push_uniq(r),y||(e(document).bind("mousemove.__ue",v),e(document).bind("touchmove.__ue",x),e(document).bind("mouseup.__ue",v),e(document).bind("touchend.__ue",x),e(document).bind("touchcancel.__ue",x),y=!0)}},add:function(t){var n,o,a,_,u=this,i=e.data(u,z),d=t.namespace,r=t.type;if(i&&(n=i.bound_ns_map,n[r]||(n[r]={}),d))for(o=d.split("."),a=0;a<o.length;a++)_=o[a],n[r][_]=!0},remove:function(t){var n,o,a,_=this,u=e.data(_,z),i=u.bound_ns_map,d=t.type,r=t.namespace;if(i[d]){if(!r)return void delete i[d];for(n=r.split("."),o=0;o<n.length;o++)a=n[o],i[d][a]&&delete i[d][a];e.isEmptyObject(i[d])&&delete i[d]}},teardown:function(n){var o,a,_,u,i=this,d=e(i),r=e.data(i,z),m=r.bound_ns_map;if(e.isEmptyObject(m)){for(u=l(n),u.push_uniq("000"),o=0;o<u.length;o++)a=u[o],a&&(_=".__ue"+a,d.unbind("mousedown"+_),d.unbind("touchstart"+_),d.unbind("mousewheel"+_));e.removeData(i,z),t.remove_val(this),0===t.length&&(e(document).unbind("mousemove.__ue"),e(document).unbind("touchmove.__ue"),e(document).unbind("mouseup.__ue"),e(document).unbind("touchend.__ue"),e(document).unbind("touchcancel.__ue"),y=!1)}}},s=function(t){var n,o=+new Date,_=t.motion_id,u=t.motion_map,i=t.bound_ns_map;delete u.idto_tapheld,u.do_allow_tap&&(u.px_end_x=u.px_start_x,u.px_end_y=u.px_start_y,u.ms_timestop=o,u.ms_elapsed=o-u.ms_timestart,i.uheld&&(n=e.Event("uheld"),e.extend(n,u),e(u.elem_bound).trigger(n)),i.uheldstart?(n=e.Event("uheldstart"),e.extend(n,u),e(u.elem_bound).trigger(n),a=_):delete f[_])},p=function(t){var n,o,a,d,r=t.motion_id,m=t.event_src,l=t.request_dzoom,p=e.data(t.elem,z),c=p.bound_ns_map,h=e(m.target),v=!1;if(!(f[r]||l&&!c.uzoomstart||h.is(p.ignore_class))){for(a=c.utap||c.uheld||c.uheldstart?!0:!1,o=k.pop();o;)h.is(o.selector_str)||e(t.elem).is(o.selector_str)?o.callback_match&&o.callback_match(t):o.callback_nomatch&&o.callback_nomatch(t),o=k.pop();return n={do_allow_tap:a,elem_bound:t.elem,elem_target:m.target,ms_elapsed:0,ms_timestart:m.timeStamp,ms_timestop:void 0,option_map:p,orig_target:m.target,px_current_x:m.clientX,px_current_y:m.clientY,px_end_x:void 0,px_end_y:void 0,px_start_x:m.clientX,px_start_y:m.clientY,timeStamp:m.timeStamp},f[r]=n,c.uzoomstart&&(l?_=r:u?i||(i=r,d=e.Event("uzoomstart"),v=!0):u=r,v)?(d=e.Event("uzoomstart"),n.px_delta_zoom=0,e.extend(d,n),void e(n.elem_bound).trigger(d)):void((c.uheld||c.uheldstart)&&(n.idto_tapheld=setTimeout(function(){s({motion_id:r,motion_map:n,bound_ns_map:c})},p.held_tap_time)))}},c=function(t){var n,d,r,m,l,s,p,c,h=t.motion_id,v=t.event_src,x=!1;if(f[h]){if(n=f[h],d=n.option_map,r=d.bound_ns_map,n.timeStamp=v.timeStamp,n.elem_target=v.target,n.ms_elapsed=v.timeStamp-n.ms_timestart,n.px_delta_x=v.clientX-n.px_current_x,n.px_delta_y=v.clientY-n.px_current_y,n.px_current_x=v.clientX,n.px_current_y=v.clientY,n.timeStamp=v.timeStamp,n.do_allow_tap&&(Math.abs(n.px_delta_x)>d.px_radius||Math.abs(n.pd_delta_y)>d.px_radius||n.ms_elapsed>d.tap_time)&&(n.do_allow_tap=!1),u&&i&&(h===u||h===i)?(f[h]=n,p=f[u],c=f[i],l=Math.floor(Math.sqrt(Math.pow(p.px_current_x-c.px_current_x,2)+Math.pow(p.px_current_y-c.px_current_y,2))+.5),s=-1===w?0:(l-w)*Y,w=l,x=!0):_===h&&r.uzoommove&&(s=n.px_delta_y*X,x=!0),x)return m=e.Event("uzoommove"),n.px_delta_zoom=s,e.extend(m,n),void e(n.elem_bound).trigger(m);a===h?r.uheldmove&&(m=e.Event("uheldmove"),e.extend(m,n),e(n.elem_bound).trigger(m)):o===h&&r.udragmove&&(m=e.Event("udragmove"),e.extend(m,n),e(n.elem_bound).trigger(m)),o||a||!r.udragstart||n.do_allow_tap!==!1||(o=h,m=e.Event("udragstart"),e.extend(m,n),e(n.elem_bound).trigger(m),n.idto_tapheld&&(clearTimeout(n.idto_tapheld),delete n.idto_tapheld))}},h=function(t){var n,d,r,m,l=t.motion_id,s=t.event_src,p=!1;S=!1,f[l]&&(n=f[l],d=n.option_map,r=d.bound_ns_map,n.elem_target=s.target,n.ms_elapsed=s.timeStamp-n.ms_timestart,n.ms_timestop=s.timeStamp,n.px_current_x&&(n.px_delta_x=s.clientX-n.px_current_x,n.px_delta_y=s.clientY-n.px_current_y),n.px_current_x=s.clientX,n.px_current_y=s.clientY,n.px_end_x=s.clientX,n.px_end_y=s.clientY,n.timeStamp=s.timeStamp,n.idto_tapheld&&(clearTimeout(n.idto_tapheld),delete n.idto_tapheld),r.utap&&n.ms_elapsed<=d.tap_time&&n.do_allow_tap&&(m=e.Event("utap"),e.extend(m,n),e(n.elem_bound).trigger(m)),l===o&&(r.udragend&&(m=e.Event("udragend"),e.extend(m,n),e(n.elem_bound).trigger(m)),o=void 0),l===a&&(r.uheldend&&(m=e.Event("uheldend"),e.extend(m,n),e(n.elem_bound).trigger(m)),a=void 0),l===_?(p=!0,_=void 0):l===u&&(i?(u=i,i=void 0,p=!0):u=void 0,w=-1),l===i&&(i=void 0,w=-1,p=!0),p&&r.uzoomend&&(m=e.Event("uzoomend"),n.px_delta_zoom=0,e.extend(m,n),e(n.elem_bound).trigger(m)),delete f[l])},x=function(e){var t,n,o,a,_=this,u=+new Date,i=e.originalEvent,d=i.changedTouches||[];switch(S=!0,e.timeStamp=u,e.type){case"touchstart":a=p,e.preventDefault();break;case"touchmove":a=c,e.preventDefault();break;case"touchend":case"touchcancel":a=h;break;default:a=null}if(a)for(t=0;t<d.length;t++)n=d[t],o="touch"+String(n.identifier),e.clientX=n.clientX,e.clientY=n.clientY,a({elem:_,motion_id:o,event_src:e})},v=function(e){var t,n=this,o="mouse"+String(e.button),a=!1;if(S)return void e.stopImmediatePropagation();if(e.shiftKey&&(a=!0),"mousemove"!==e.type&&0!==e.button)return!0;switch(e.type){case"mousedown":t=p;break;case"mouseup":t=h;break;case"mousemove":t=c,e.preventDefault();break;default:t=null}t&&t({elem:n,event_src:e,request_dzoom:a,motion_id:o})},g.ue=g.utap=g.uheld=g.uzoomstart=g.uzoommove=g.uzoomend=g.udragstart=g.udragmove=g.udragend=g.uheldstart=g.uheldmove=g.uheldend=n,e.ueSetGlobalCb=function(e,t,n){k.push({selector_str:e||"",callback_match:t||null,callback_nomatch:n||null})}}(jQuery);
